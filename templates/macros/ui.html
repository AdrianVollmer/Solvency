{#
    UI component macros for consistent styling across all templates.

    Usage:
    {% import "macros/ui.html" as ui %}

    Card (container with consistent styling):
    {% call ui::card() %}
        <p>Card content here</p>
    {% endcall %}
    {% call ui::card(class="p-4") %}
        <p>Card with custom padding</p>
    {% endcall %}
    {% call ui::card(class="p-6", overflow="overflow-hidden") %}
        <table>...</table>
    {% endcall %}

    Form field (label + input wrapper):
    {% call ui::field(label="Email") %}
        <input type="email" name="email" class="input w-full">
    {% endcall %}
    {% call ui::field(label="Username", id="username-input") %}
        <input type="text" id="username-input" name="username" class="input w-full">
    {% endcall %}

    Page header (detail pages with back link, title, optional metadata):
    {% call ui::page_header(title="Apple Inc.", back_url="/trading/positions", back_label="Positions") %}
    {% call ui::page_header(
        title="AAPL",
        back_url="/trading/positions",
        back_label="Positions",
        subtitle="Apple Inc.",
        badge="ETF",
        external_url="https://finance.yahoo.com/quote/AAPL/",
        external_title="View on Yahoo Finance"
    ) %}

    Badge (simple colored badge):
    {% call ui::badge(color="#3b82f6", content="Label") %}

    Category badge (with color dot):
    {% call ui::category_badge(color="#3b82f6", name="Food") %}

    Status badge (predefined type styles):
    {% call ui::status_badge(badge_type="buy", label="Buy") %}

    Delete button (for row deletion with HTMX):
    {% call ui::delete_button(target="rule-123", endpoint="/rules/123", confirm="Delete?", label="Delete rule") %}

    Delete action with redirect:
    {% call ui::delete_action_redirect(endpoint="/transactions/123", confirm="Delete?", label="Delete", redirect="/transactions") %}

    Delete action with reload:
    {% call ui::delete_action_reload(endpoint="/transactions/delete-all", confirm="Delete all?", label="Delete All") %}

    Empty state (pass any Lucide icon name):
    {% call ui::empty_state(icon="trending-up", title="No items") %}
    {% call ui::empty_state_action(icon="folder", title="No items", description="Add some items", action_url="/add", action_label="Add Item") %}

    Stat card:
    {% call ui::stat_card(label="Total", value="$100") %}
    {% call ui::stat_card_with_secondary(label="Gain", value="+$50", secondary="10%", trend="up") %}

    Tag badge:
    {% call ui::tag_badge_solid(color="#3b82f6", name="Tag", text_color="white") %}
    {% call ui::tag_badge(color="#3b82f6", name="Tag", text_color="#1e3a5f") %}
    {% call ui::tag_badge_striped(color="#3b82f6", name="Tag", text_color="#1e3a5f") %}

    Mobile overflow menu (three-dot dropdown for secondary actions):
    {% call ui::overflow_menu() %}
        <a href="/export" download class="dropdown-item" role="menuitem">Export</a>
    {% endcall %}

    Page action bar (resource listing pages):
    {% call ui::page_action_bar(
        export_url="/tags/export",
        import_url="/tags/import",
        delete_endpoint="/tags/delete-all",
        delete_confirm="Are you sure you want to delete ALL tags?",
        add_url="/tags/new",
        add_label="Add Tag"
    ) %}{% endcall %}

    Detail field (for dt/dd definition lists in detail pages):
    {% call ui::detail_field(label="Date") %}{{ transaction.date }}{% endcall %}
    {% call ui::detail_field(label="IBAN", mono=true) %}{{ iban }}{% endcall %}
    {% call ui::detail_field(label="Creditor ID", mono=true, small=true) %}{{ cid }}{% endcall %}

    Section with title and card container:
    {% call ui::section(title="Appearance") %}
        <fieldset>...</fieldset>
    {% endcall %}
    {% call ui::section(title="Regional", card_class="p-6 space-y-6") %}...{% endcall %}
    {% call ui::section(title="Database", class="max-w-2xl", card_class="p-6 space-y-6") %}...{% endcall %}

    Page container (centered content with max width):
    {% call ui::page_container() %}...{% endcall %}
    {% call ui::page_container(max_width="max-w-4xl") %}...{% endcall %}
#}

{# Page container - centered content area for form / detail / edit pages #}
{# max_width: Tailwind max-width class (default: "max-w-2xl") #}
{% macro page_container(max_width="max-w-2xl") %}
<div class="space-y-6 {{ max_width }} mx-auto">
    {{ caller() }}
</div>
{% endmacro %}

{# Date range filter with progressive disclosure #}
{# page_url: Base URL for the page (e.g., "/spending", "/transactions") #}
{# date_range: DateRange object with from/to dates and optional preset #}
{# presets: Slice of DatePreset variants to show in the dropdown #}
{# base_qs: Extra query string to preserve across navigation (e.g., "tab=category" or "search=foo&category_id=5") #}
{# Body (caller): Extra hidden inputs for the custom date form #}
{% macro date_filter(page_url, date_range, presets, base_qs="") %}
<div role="group" aria-label="Date range filter" class="space-y-2">
    <div class="flex flex-wrap items-center gap-1.5 sm:gap-2">
        <a href="{{ page_url }}?{% if base_qs != "" %}{{ base_qs }}&amp;{% endif %}from_date={{ date_range.prev().from_str() }}&amp;to_date={{ date_range.prev().to_str() }}{% if date_range.prev().preset.is_some() %}&amp;preset={{ date_range.prev().preset.unwrap().as_str() }}{% endif %}"
            class="p-3 sm:p-2.5 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-lg transition-colors"
            aria-label="Previous period">
            <span class="icon-xs" aria-hidden="true">{{ icons.get("chevron-left")|safe }}</span>
        </a>
        <span class="font-display font-semibold text-neutral-900 dark:text-white text-sm min-w-0 truncate">
            {{ date_range.display_label() }}
        </span>
        <a href="{{ page_url }}?{% if base_qs != "" %}{{ base_qs }}&amp;{% endif %}from_date={{ date_range.next().from_str() }}&amp;to_date={{ date_range.next().to_str() }}{% if date_range.next().preset.is_some() %}&amp;preset={{ date_range.next().preset.unwrap().as_str() }}{% endif %}"
            class="p-3 sm:p-2.5 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-lg transition-colors"
            aria-label="Next period">
            <span class="icon-xs" aria-hidden="true">{{ icons.get("chevron-right")|safe }}</span>
        </a>

        <div class="flex items-center gap-2 ml-auto">
            <label for="date-preset-select" class="sr-only">Date range preset</label>
            <select id="date-preset-select" class="select text-sm py-2.5"
                onchange="if(this.value==='custom'){document.getElementById('custom-date-row').classList.remove('hidden')}else{window.location.href='{{ page_url }}?{% if base_qs != "" %}{{ base_qs }}&amp;{% endif %}preset='+this.value}">
                {% for preset in presets %}
                <option value="{{ preset.as_str() }}"{% if date_range.is_preset(preset) %} selected{% endif %}>{{ preset.label() }}</option>
                {% endfor %}
                <option value="custom"{% if date_range.preset.is_none() %} selected{% endif %}>Custom range</option>
            </select>
        </div>
    </div>

    {# Custom date range - hidden when a preset is active #}
    <form action="{{ page_url }}" method="get" id="custom-date-row"
        class="flex flex-wrap items-center gap-2 {% if date_range.preset.is_some() %}hidden{% endif %}">
        {{ caller() }}
        <label for="filter_from_date" class="sr-only">From date</label>
        <input type="date" id="filter_from_date" name="from_date" value="{{ date_range.from_str() }}"
            class="input text-sm py-2.5">
        <span class="text-neutral-500 dark:text-neutral-400 text-sm">to</span>
        <label for="filter_to_date" class="sr-only">To date</label>
        <input type="date" id="filter_to_date" name="to_date" value="{{ date_range.to_str() }}"
            class="input text-sm py-2.5">
        <button type="submit" class="btn-secondary px-3 py-2.5 text-sm rounded-lg">
            Apply
        </button>
    </form>
</div>
{% endmacro %}

{# Card container - the most common UI pattern #}
{# class: Additional classes (typically padding like "p-4" or "p-6", default: "p-6") #}
{# overflow: Overflow behavior (default: "" for normal, use "overflow-hidden" for tables) #}
{% macro card(class="p-6", overflow="") %}
<div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 {{ class }} {{ overflow }}">
    {{ caller() }}
</div>
{% endmacro %}

{# Form field wrapper with label #}
{# label: The label text (required) #}
{# id: The id for the for attribute (optional, omit if input has no id) #}
{# Body should contain the input, select, or textarea element #}
{% macro field(label, id="") %}
<div>
    <label {% if id != "" %}for="{{ id }}"{% endif %} class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">{{ label }}</label>
    {{ caller() }}
</div>
{% endmacro %}

{# Page header for detail pages #}
{# title: Main heading (required) #}
{# back_url: URL for back link (empty to hide) #}
{# back_label: Text for back link (empty for icon-only) #}
{# subtitle: Secondary text below title #}
{# subtitle_extra: Additional muted text after subtitle #}
{# badge: Badge text next to title #}
{# external_url: External link URL #}
{# external_title: Tooltip for external link #}
{# title_mono: Add monospace font to title #}
{% macro page_header(title, back_url="", back_label="", subtitle="", subtitle_extra="", badge="", external_url="", external_title="", title_mono=false) %}
<div>
    {% if back_url != "" %}
    <a href="{{ back_url }}" class="inline-flex items-center gap-1.5 text-sm text-neutral-500 hover:text-neutral-900 dark:hover:text-white transition-colors">
        <span class="icon-xs" aria-hidden="true">{{ icons.get("arrow-left")|safe }}</span>
        {% if back_label != "" %}{{ back_label }}{% endif %}
    </a>
    {% endif %}
    <div class="{% if back_url != "" %}mt-3{% endif %}">
        <div class="flex items-baseline gap-3">
            <h1 class="page-title{% if title_mono %} font-mono{% endif %}">{{ title }}</h1>
            {% if badge != "" %}
            <span class="px-1.5 py-0.5 bg-neutral-100 dark:bg-neutral-700 rounded text-xs font-medium text-neutral-600 dark:text-neutral-300">{{ badge }}</span>
            {% endif %}
            {% if external_url != "" %}
            <a href="{{ external_url }}" target="_blank" rel="noopener noreferrer" class="text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 transition-colors" {% if external_title != "" %}title="{{ external_title }}"{% endif %}>
                <span class="icon-xs" aria-hidden="true">{{ icons.get("external-link")|safe }}</span>
            </a>
            {% endif %}
        </div>
        {% if subtitle != "" || subtitle_extra != "" %}
        <div class="mt-1 flex items-center gap-2 text-sm text-neutral-500 dark:text-neutral-400">
            {% if subtitle != "" %}<span>{{ subtitle }}</span>{% endif %}
            {% if subtitle != "" && subtitle_extra != "" %}<span>Â·</span>{% endif %}
            {% if subtitle_extra != "" %}<span>{{ subtitle_extra }}</span>{% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{# Simple colored badge (ghost style with transparent background) #}
{% macro badge(color, content) %}
<span class="inline-flex items-center text-xs font-medium px-2 py-0.5 rounded" style="background-color: {{ color }}14; color: {{ color }};">{{ content }}</span>
{% endmacro %}

{# Category badge with color dot #}
{% macro category_badge(color, name) %}
<span class="inline-flex items-center gap-1.5 text-xs font-medium px-2.5 py-0.5 rounded-full" style="background-color: {{ color }}14; color: {{ color }};">
    <span class="inline-block w-2 h-2 rounded-full" style="background-color: {{ color }};"></span>
    <span>{{ name }}</span>
</span>
{% endmacro %}

{# Status badge with predefined type-based styling #}
{% macro status_badge(badge_type, label) %}
{% if badge_type == "buy" || badge_type == "add_holding" || badge_type == "success" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300">{{ label }}</span>
{% else if badge_type == "sell" || badge_type == "remove_holding" || badge_type == "error" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300">{{ label }}</span>
{% else if badge_type == "dividend" || badge_type == "interest" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">{{ label }}</span>
{% else if badge_type == "deposit" || badge_type == "transfer_in" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-300">{{ label }}</span>
{% else if badge_type == "withdrawal" || badge_type == "transfer_out" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300">{{ label }}</span>
{% else if badge_type == "fee" || badge_type == "tax" || badge_type == "warning" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300">{{ label }}</span>
{% else if badge_type == "split" %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300">{{ label }}</span>
{% else %}
<span class="inline-flex items-center text-xs font-medium px-2.5 py-0.5 rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">{{ label }}</span>
{% endif %}
{% endmacro %}

{# Tag badge (auto style based on tag style field) #}
{% macro tag_badge_auto(style, color, name, text_color, ghost_text_color) %}
{% if style == "solid" %}
{% call tag_badge_solid(color=color, name=name, text_color=text_color) %}{% endcall %}
{% else if style == "striped" %}
{% call tag_badge_striped(color=color, name=name, text_color=ghost_text_color) %}{% endcall %}
{% else %}
{% call tag_badge(color=color, name=name, text_color=ghost_text_color) %}{% endcall %}
{% endif %}
{% endmacro %}

{# Tag badge (solid style) #}
{% macro tag_badge_solid(color, name, text_color) %}
<span class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background-color: {{ color }}; color: {{ text_color }};">{{ name }}</span>
{% endmacro %}

{# Tag badge (ghost/outline style) #}
{% macro tag_badge(color, name, text_color) %}
<span class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background-color: {{ color }}1a; color: {{ text_color }};">{{ name }}</span>
{% endmacro %}

{# Tag badge (striped style) #}
{% macro tag_badge_striped(color, name, text_color) %}
<span class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background: repeating-linear-gradient(135deg, {{ color }}25 0px, {{ color }}25 2px, {{ color }}0a 2px, {{ color }}0a 6px); color: {{ text_color }};">{{ name }}</span>
{% endmacro %}

{# Tag badge with delete button (solid style) #}
{% macro tag_badge_deletable_solid(color, name, tag_id, text_color) %}
<span id="tag-{{ tag_id }}" class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background-color: {{ color }}; color: {{ text_color }};">
    {{ name }}
    <button
        hx-delete="/tags/{{ tag_id }}"
        hx-target="#tag-{{ tag_id }}"
        hx-swap="outerHTML"
        hx-confirm="Are you sure you want to delete this tag?"
        hx-disabled-elt="this"
        class="hover:opacity-75"
        aria-label="Delete tag {{ name }}">
        <span class="w-3 h-3">{{ icons.get("x")|safe }}</span>
    </button>
</span>
{% endmacro %}

{# Tag badge with delete button (ghost/outline style) #}
{% macro tag_badge_deletable(color, name, tag_id, text_color) %}
<span id="tag-{{ tag_id }}" class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background-color: {{ color }}1a; color: {{ text_color }};">
    {{ name }}
    <button
        hx-delete="/tags/{{ tag_id }}"
        hx-target="#tag-{{ tag_id }}"
        hx-swap="outerHTML"
        hx-confirm="Are you sure you want to delete this tag?"
        hx-disabled-elt="this"
        class="hover:opacity-75"
        aria-label="Delete tag {{ name }}">
        <span class="w-3 h-3">{{ icons.get("x")|safe }}</span>
    </button>
</span>
{% endmacro %}

{# Tag badge with delete button (striped style) #}
{% macro tag_badge_deletable_striped(color, name, tag_id, text_color) %}
<span id="tag-{{ tag_id }}" class="inline-flex items-center gap-1 text-sm font-medium px-2 py-1 rounded-full" style="background: repeating-linear-gradient(135deg, {{ color }}25 0px, {{ color }}25 2px, {{ color }}0a 2px, {{ color }}0a 6px); color: {{ text_color }};">
    {{ name }}
    <button
        hx-delete="/tags/{{ tag_id }}"
        hx-target="#tag-{{ tag_id }}"
        hx-swap="outerHTML"
        hx-confirm="Are you sure you want to delete this tag?"
        hx-disabled-elt="this"
        class="hover:opacity-75"
        aria-label="Delete tag {{ name }}">
        <span class="w-3 h-3">{{ icons.get("x")|safe }}</span>
    </button>
</span>
{% endmacro %}

{# Delete button for row deletion with HTMX (generic) #}
{% macro delete_button(target, endpoint, confirm, label) %}
<button
    hx-delete="{{ endpoint }}"
    hx-target="#{{ target }}"
    hx-swap="outerHTML"
    hx-confirm="{{ confirm }}"
    hx-disabled-elt="this"
    class="p-2 text-neutral-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
    aria-label="{{ label }}">
    <span class="icon-sm" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
</button>
{% endmacro %}

{# Delete button for categories #}
{% macro delete_category_button(category_id, confirm, label) %}
<button
    hx-delete="/categories/{{ category_id }}"
    hx-target="#category-{{ category_id }}"
    hx-swap="outerHTML"
    hx-confirm="{{ confirm }}"
    hx-disabled-elt="this"
    class="p-2 text-neutral-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors"
    aria-label="{{ label }}">
    <span class="icon-sm" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
</button>
{% endmacro %}

{# Delete action button with redirect #}
{% macro delete_action_redirect(endpoint, confirm, label, redirect) %}
<button
    hx-delete="{{ endpoint }}"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.href='{{ redirect }}'"
    hx-disabled-elt="this"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    {{ label }}
</button>
{% endmacro %}

{# Delete transaction action with redirect to transactions list #}
{% macro delete_transaction_action(transaction_id, confirm, label) %}
<button
    hx-delete="/transactions/{{ transaction_id }}"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.href='/transactions'"
    hx-disabled-elt="this"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    {{ label }}
</button>
{% endmacro %}

{# Delete category action with redirect to categories list #}
{% macro delete_category_action(category_id, confirm, label) %}
<button
    hx-delete="/categories/{{ category_id }}"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.href='/manage?tab=categories'"
    hx-disabled-elt="this"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    {{ label }}
</button>
{% endmacro %}

{# Delete rule action with redirect to rules list #}
{% macro delete_rule_action(rule_id, confirm, label) %}
<button
    hx-delete="/rules/{{ rule_id }}/delete"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.href='/manage?tab=rules'"
    hx-disabled-elt="this"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    {{ label }}
</button>
{% endmacro %}

{# Delete trading activity action with redirect to activities list #}
{% macro delete_trading_activity_action(activity_id, confirm, label) %}
<button
    hx-delete="/trading/activities/{{ activity_id }}/delete"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.href='/trading/activities'"
    hx-disabled-elt="this"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    {{ label }}
</button>
{% endmacro %}

{# Delete action button with reload #}
{% macro delete_action_reload(endpoint, confirm, label, label_class="") %}
<button
    hx-delete="{{ endpoint }}"
    hx-confirm="{{ confirm }}"
    hx-target="body"
    hx-swap="none"
    hx-on::after-request="if(event.detail.successful) window.location.reload()"
    hx-disabled-elt="this"
    title="{{ label }}"
    class="px-4 py-2 border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors inline-flex items-center gap-2">
    <span class="icon-xs" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
    <span class="{{ label_class }}">{{ label }}</span>
</button>
{% endmacro %}

{# Empty state component (minimal) #}
{# icon: the icon name (e.g., "trending-up", "folder") #}
{% macro empty_state(icon, title) %}
<div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 p-8 text-center">
    <span class="inline-block w-12 h-12 mx-auto mb-4 text-neutral-300 dark:text-neutral-600" aria-hidden="true">{{ icons.get(icon)|safe }}</span>
    <p class="font-medium text-neutral-900 dark:text-white">{{ title }}</p>
</div>
{% endmacro %}

{# Empty state component with description #}
{# icon: the icon name (e.g., "trending-up", "folder") #}
{% macro empty_state_desc(icon, title, description) %}
<div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 p-8 text-center">
    <span class="inline-block w-12 h-12 mx-auto mb-4 text-neutral-300 dark:text-neutral-600" aria-hidden="true">{{ icons.get(icon)|safe }}</span>
    <p class="font-medium text-neutral-900 dark:text-white">{{ title }}</p>
    <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1">{{ description }}</p>
</div>
{% endmacro %}

{# Empty state component with action #}
{# icon: the icon name (e.g., "trending-up", "folder") #}
{% macro empty_state_action(icon, title, description, action_url, action_label) %}
<div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 p-8 text-center">
    <span class="inline-block w-12 h-12 mx-auto mb-4 text-neutral-300 dark:text-neutral-600" aria-hidden="true">{{ icons.get(icon)|safe }}</span>
    <p class="font-medium text-neutral-900 dark:text-white">{{ title }}</p>
    <p class="text-sm text-neutral-500 dark:text-neutral-400 mt-1">{{ description }}</p>
    <a href="{{ action_url }}" class="mt-4 inline-block btn btn-primary">{{ action_label }}</a>
</div>
{% endmacro %}

{# Stat card (simple) #}
{% macro stat_card(label, value) %}
<div class="bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 px-4 py-3">
    <p class="text-xs text-neutral-500 dark:text-neutral-400">{{ label }}</p>
    <p class="text-xl font-semibold text-neutral-900 dark:text-white">{{ value }}</p>
</div>
{% endmacro %}

{# Stat card with secondary text (neutral) #}
{% macro stat_card_secondary(label, value, secondary) %}
<div class="bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 px-4 py-3">
    <p class="text-xs text-neutral-500 dark:text-neutral-400">{{ label }}</p>
    <p class="text-xl font-semibold text-neutral-900 dark:text-white">{{ value }}</p>
    <p class="text-sm text-neutral-600 dark:text-neutral-400">{{ secondary }}</p>
</div>
{% endmacro %}

{# Stat card with upward trend #}
{% macro stat_card_trend_up(label, value, secondary) %}
<div class="bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 px-4 py-3">
    <p class="text-xs text-neutral-500 dark:text-neutral-400">{{ label }}</p>
    <p class="text-xl font-semibold text-neutral-900 dark:text-white">{{ value }}</p>
    <p class="text-sm text-green-600 dark:text-green-400">{{ secondary }}</p>
</div>
{% endmacro %}

{# Stat card with downward trend #}
{% macro stat_card_trend_down(label, value, secondary) %}
<div class="bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 px-4 py-3">
    <p class="text-xs text-neutral-500 dark:text-neutral-400">{{ label }}</p>
    <p class="text-xl font-semibold text-neutral-900 dark:text-white">{{ value }}</p>
    <p class="text-sm text-red-600 dark:text-red-400">{{ secondary }}</p>
</div>
{% endmacro %}

{# Mobile overflow menu (three-dot dropdown, hidden on desktop) #}
{# Body (caller): dropdown items (links, buttons with .dropdown-item) #}
{% macro overflow_menu() %}
<div class="relative md:hidden" data-dropdown>
    <button type="button" class="btn btn-secondary flex items-center justify-center !px-2.5" aria-haspopup="true" data-dropdown-toggle aria-label="More actions">
        <span class="icon-sm" aria-hidden="true">{{ icons.get("ellipsis-vertical")|safe }}</span>
    </button>
    <div class="dropdown-menu hidden absolute left-0 top-full mt-1 w-48 py-1 bg-white dark:bg-neutral-800 rounded-lg border border-neutral-200 dark:border-neutral-700 shadow-lg z-20" role="menu">
        {{ caller() }}
    </div>
</div>
{% endmacro %}

{# Page action bar for resource listing pages #}
{# Primary "Add" button always visible; secondary actions in overflow menu on mobile #}
{# delete_count: Number of records (shown in confirm modal). Pass 0 to omit count. #}
{% macro page_action_bar(export_url, import_url, delete_endpoint, delete_confirm, add_url, add_label, delete_count) %}
<div class="flex items-center gap-2">
    {# Desktop: inline secondary actions (hidden on mobile) #}
    <a href="{{ export_url }}" download class="hidden md:inline-flex btn btn-secondary items-center gap-2">
        <span class="icon-sm" aria-hidden="true">{{ icons.get("download")|safe }}</span>
        Export
    </a>
    <button onclick="document.getElementById('import-file').click()" class="hidden md:inline-flex btn btn-secondary items-center gap-2">
        <span class="icon-sm" aria-hidden="true">{{ icons.get("upload")|safe }}</span>
        Import
    </button>
    <button
        hx-delete="{{ delete_endpoint }}"
        data-confirm-modal="{% if *delete_count > 0 %}{{ delete_confirm }} ({{ delete_count }} records){% else %}{{ delete_confirm }}{% endif %}"
        hx-target="body"
        hx-swap="none"
        hx-on::after-request="if(event.detail.successful) window.location.reload()"
        hx-disabled-elt="this"
        class="hidden md:inline-flex btn btn-danger-outline items-center gap-2">
        <span class="icon-sm" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
        Delete All
    </button>

    {# Mobile: overflow menu for secondary actions (hidden on desktop) #}
    {% call overflow_menu() %}
        <a href="{{ export_url }}" download class="dropdown-item" role="menuitem">
            <span class="icon-sm" aria-hidden="true">{{ icons.get("download")|safe }}</span>
            Export
        </a>
        <button type="button" onclick="document.getElementById('import-file').click()" class="dropdown-item w-full" role="menuitem">
            <span class="icon-sm" aria-hidden="true">{{ icons.get("upload")|safe }}</span>
            Import
        </button>
        <hr class="my-1 border-neutral-200 dark:border-neutral-700">
        <button type="button"
            hx-delete="{{ delete_endpoint }}"
            data-confirm-modal="{% if *delete_count > 0 %}{{ delete_confirm }} ({{ delete_count }} records){% else %}{{ delete_confirm }}{% endif %}"
            hx-target="body"
            hx-swap="none"
            hx-on::after-request="if(event.detail.successful) window.location.reload()"
            hx-disabled-elt="this"
            class="dropdown-item w-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20" role="menuitem">
            <span class="icon-sm" aria-hidden="true">{{ icons.get("trash-2")|safe }}</span>
            Delete All
        </button>
    {% endcall %}

    {# Primary action: always visible #}
    <a href="{{ add_url }}" class="btn btn-primary flex items-center gap-2">
        <span class="icon-sm" aria-hidden="true">{{ icons.get("plus")|safe }}</span>
        {{ add_label }}
    </a>

    {# Shared hidden file input for import #}
    <input type="file" id="import-file" accept=".json" class="hidden" onchange="importResource(this.files[0], '{{ import_url }}')" aria-label="Import from JSON file">
</div>
{% endmacro %}

{# Detail field for definition lists (dt/dd pattern) #}
{# label: The field label #}
{# mono: Add monospace font to value (for IBANs, codes, etc.) #}
{# small: Use smaller text size (for dense layouts like SEPA details) #}
{% macro detail_field(label, mono=false, small=false) %}
<div>
    <dt class="{% if small %}text-xs{% else %}text-sm{% endif %} font-medium text-neutral-500 dark:text-neutral-400">{{ label }}</dt>
    <dd class="mt-1 {% if small %}text-sm {% endif %}text-neutral-900 dark:text-white{% if mono %} font-mono{% if !small %} text-sm{% endif %}{% endif %}">{{ caller() }}</dd>
</div>
{% endmacro %}

{# Section with title and card container #}
{# title: Section heading #}
{# class: Additional classes for the section element (e.g., "max-w-2xl") #}
{# card_class: Classes for the card (default "p-6", use "p-6 space-y-6" for spaced content) #}
{% macro section(title, class="", card_class="p-6") %}
<section{% if class != "" %} class="{{ class }}"{% endif %}>
    <h2 class="section-title mb-4">{{ title }}</h2>
    <div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 {{ card_class }}">
        {{ caller() }}
    </div>
</section>
{% endmacro %}

