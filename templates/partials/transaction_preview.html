{% import "macros/ui.html" as ui %}
<div class="border-t border-neutral-200 dark:border-neutral-700 mt-4 pt-4">
<div class="flex items-center justify-between mb-1">
    <h3 class="text-sm font-semibold text-neutral-900 dark:text-white">
        {{ title }}
    </h3>
    <div class="flex items-center gap-2">
        <span class="text-xs text-neutral-500 dark:text-neutral-400">{{ count }} transaction{% if count != 1 %}s{% endif %}</span>
        <button type="button" class="preview-close-btn p-1.5 text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-300 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-lg transition-colors"
            aria-label="Close transaction list">
            <span class="icon-sm" aria-hidden="true">{{ icons.get("x")|safe }}</span>
        </button>
    </div>
</div>
<p class="text-xs text-neutral-500 dark:text-neutral-400 mb-3">{{ subtitle }}</p>
{% if transactions.is_empty() %}
<p class="text-sm text-neutral-500 dark:text-neutral-400">No transactions for this period.</p>
{% else %}
<div class="overflow-x-auto">
    <table class="w-full text-left" data-sortable-preview>
        <thead>
            <tr class="border-b border-neutral-200 dark:border-neutral-700">
                <th class="px-3 py-2 text-xs font-medium text-neutral-500 dark:text-neutral-400 cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-200" data-sort-key="0">Date <span class="sort-indicator"></span></th>
                <th class="px-3 py-2 text-xs font-medium text-neutral-500 dark:text-neutral-400 cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-200" data-sort-key="1">Description <span class="sort-indicator"></span></th>
                <th class="px-3 py-2 text-xs font-medium text-neutral-500 dark:text-neutral-400 cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-200" data-sort-key="2">Category <span class="sort-indicator"></span></th>
                <th class="px-3 py-2 text-xs font-medium text-neutral-500 dark:text-neutral-400 text-right cursor-pointer select-none hover:text-neutral-700 dark:hover:text-neutral-200" data-sort-key="3">Amount <span class="sort-indicator"></span></th>
            </tr>
        </thead>
        <tbody class="divide-y divide-neutral-100 dark:divide-neutral-700/50">
            {% for t in transactions %}
            <tr onclick="window.location.href='/transactions/{{ t.id }}'"
                class="hover:bg-neutral-50 dark:hover:bg-neutral-700/50 cursor-pointer">
                <td class="px-3 py-2 whitespace-nowrap text-sm tabular-nums text-neutral-600 dark:text-neutral-400" data-sort-value="{{ t.date }}">{{ t.date }}</td>
                <td class="px-3 py-2 text-sm" data-sort-value="{{ t.description|lower }}">
                    <div class="font-medium text-neutral-900 dark:text-white">{{ t.description }}</div>
                    {% match t.counterparty() %}
                    {% when Some with (cp) %}
                    <div class="text-xs text-neutral-500 dark:text-neutral-400 truncate max-w-xs">{{ cp }}</div>
                    {% when None %}{% endmatch %}
                </td>
                <td class="px-3 py-2 whitespace-nowrap" data-sort-value="{{ t.category_name_or_default()|lower }}">
                    {% if t.has_category() %}
                    {% call ui::category_badge(color=t.category_color_or_default(), name=t.category_name_or_default()) %}{% endcall %}
                    {% else %}
                    <span class="text-neutral-400 text-xs">Uncategorized</span>
                    {% endif %}
                </td>
                <td class="px-3 py-2 whitespace-nowrap text-sm font-semibold text-right tabular-nums" data-sort-value="{{ t.amount_cents }}">
                    {{ settings.format_money(t.amount_cents)|safe }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<div class="mt-3 text-center">
    <a href="{{ view_all_url }}" class="text-xs text-blue-600 dark:text-blue-400 hover:underline">
        View all {{ count }} transactions &rarr;
    </a>
</div>
{% endif %}
</div>
