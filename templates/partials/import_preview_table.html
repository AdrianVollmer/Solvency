<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-neutral-50 dark:bg-neutral-900">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Row</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Description</th>
                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Amount</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Category</th>
            </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% for row in rows %}
            <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">
                    {{ row.row_index + 1 }}
                </td>
                <td class="px-4 py-3 text-sm whitespace-nowrap">
                    {{ row.data.date }}
                </td>
                <td class="px-4 py-3 text-sm max-w-xs truncate" title="{{ row.data.description }}">
                    {{ row.data.description }}
                </td>
                <td class="px-4 py-3 text-sm text-right whitespace-nowrap font-mono">
                    {{ row.data.currency }} {{ row.data.amount }}
                </td>
                <td class="px-4 py-3 text-sm">
                    <select name="category_id"
                            class="text-sm rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 py-1"
                            hx-post="/import/{{ session_id }}/rows/{{ row.id }}/category"
                            hx-target="closest td"
                            hx-swap="innerHTML"
                            hx-trigger="change">
                        <option value="">Uncategorized</option>
                        {% for cat in categories %}
                        <option value="{{ cat.category.id }}" {% if row.category_id.is_some() && row.category_id.unwrap() == cat.category.id %}selected{% endif %}>
                            {{ cat.path }}
                        </option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if total_count > page_size %}
<div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between">
    {% let start = (page - 1) * page_size + 1 %}
    {% let end_calc = page * page_size %}
    <p class="text-sm text-gray-600 dark:text-gray-400">
        Showing {{ start }} - {% if end_calc > total_count %}{{ total_count }}{% else %}{{ end_calc }}{% endif %} of {{ total_count }} rows
    </p>
    <div class="flex gap-2">
        {% if page > 1 %}
        <button hx-get="/import/{{ session_id }}/rows?page={{ page - 1 }}"
                hx-target="#preview-table"
                hx-swap="innerHTML"
                class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600">
            Previous
        </button>
        {% endif %}
        {% if page * page_size < total_count %}
        <button hx-get="/import/{{ session_id }}/rows?page={{ page + 1 }}"
                hx-target="#preview-table"
                hx-swap="innerHTML"
                class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 rounded hover:bg-gray-200 dark:hover:bg-gray-600">
            Next
        </button>
        {% endif %}
    </div>
</div>
{% endif %}
