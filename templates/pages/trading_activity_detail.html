{% extends "base.html" %}
{% import "macros/ui.html" as ui %}

{% block content %}
{% call ui::page_container(max_width="max-w-4xl") %}
    <div class="flex items-start justify-between gap-4">
        {% call ui::page_header(title="Activity Details", back_url="/trading/activities", back_label="Activities") %}{% endcall %}
        <div class="flex gap-2">
            <a href="/trading/activities/{{ activity.id }}/edit"
                class="px-4 py-2 border border-neutral-300 dark:border-neutral-600 text-neutral-700 dark:text-neutral-300 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-colors inline-flex items-center gap-2">
                <span class="icon-xs" aria-hidden="true">{{ icons.get("pencil")|safe }}</span>
                Edit
            </a>
            {% call ui::delete_trading_activity_action(activity_id=activity.id, confirm="Are you sure you want to delete this activity?", label="Delete") %}{% endcall %}
        </div>
    </div>

    {# Main Info Card #}
    {% call ui::card(class="") %}
        <div class="p-6 border-b border-neutral-200 dark:border-neutral-700">
            <div class="flex items-start justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-neutral-900 dark:text-white">{{ activity.symbol }}</h2>
                    <p class="mt-1 text-neutral-600 dark:text-neutral-400">{{ activity.date }}</p>
                </div>
                <div class="text-right">
                    {% match activity.total_value_cents() %}
                    {% when Some with (cents) %}
                    <div class="text-2xl font-bold text-neutral-900 dark:text-white">{{ settings.format_money_neutral_with_currency(cents, activity.currency) }}</div>
                    {% when None %}
                    <div class="text-2xl font-bold text-neutral-400">-</div>
                    {% endmatch %}
                    {% let type_str = activity.activity_type.as_str() %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-1
                        {% if type_str == "BUY" %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300{% endif %}
                        {% if type_str == "SELL" %}bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300{% endif %}
                        {% if type_str == "DIVIDEND" %}bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300{% endif %}
                        {% if type_str == "FEE" || type_str == "TAX" %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300{% endif %}
                        {% if type_str == "SPLIT" %}bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300{% endif %}
                    ">
                        {{ activity.activity_type.label() }}
                    </span>
                </div>
            </div>
        </div>

        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
            {# Left Column #}
            <div class="space-y-4">
                {% call ui::detail_field(label="Date") %}{{ activity.date }}{% endcall %}
                {% call ui::detail_field(label="Symbol") %}{{ activity.symbol }}{% endcall %}
                {% call ui::detail_field(label="Activity Type") %}{{ activity.activity_type.label() }}{% endcall %}

                {% if activity.quantity.is_some() %}
                <div>
                    <dt class="text-sm font-medium text-neutral-500 dark:text-neutral-400">Quantity</dt>
                    <dd class="mt-1 text-neutral-900 dark:text-white tabular-nums">{{ activity.quantity_display() }}</dd>
                </div>
                {% endif %}
            </div>

            {# Right Column #}
            <div class="space-y-4">
                {% match activity.unit_price_cents %}
                {% when Some with (cents) %}
                <div>
                    <dt class="text-sm font-medium text-neutral-500 dark:text-neutral-400">Unit Price</dt>
                    <dd class="mt-1 text-neutral-900 dark:text-white tabular-nums">{{ settings.format_money_neutral_with_currency(cents, activity.currency) }}</dd>
                </div>
                {% when None %}
                {% endmatch %}

                {% match activity.total_value_cents() %}
                {% when Some with (cents) %}
                <div>
                    <dt class="text-sm font-medium text-neutral-500 dark:text-neutral-400">Total Amount</dt>
                    <dd class="mt-1 text-neutral-900 dark:text-white font-semibold tabular-nums">{{ settings.format_money_neutral_with_currency(cents, activity.currency) }}</dd>
                </div>
                {% when None %}
                {% endmatch %}

                {% call ui::detail_field(label="Currency") %}{{ activity.currency }}{% endcall %}

                {% if activity.fee_cents != 0 %}
                <div>
                    <dt class="text-sm font-medium text-neutral-500 dark:text-neutral-400">Fee</dt>
                    <dd class="mt-1 text-neutral-900 dark:text-white tabular-nums">{{ settings.format_money_neutral_with_currency(activity.fee_cents, activity.currency) }}</dd>
                </div>
                {% endif %}
            </div>
        </div>
    {% endcall %}

    {# Notes Section #}
    {% match activity.notes %}
    {% when Some with (notes) %}
    {% call ui::card() %}
        <h3 class="text-sm font-medium text-neutral-500 dark:text-neutral-400 mb-2">Notes</h3>
        <p class="text-neutral-900 dark:text-white whitespace-pre-wrap">{{ notes }}</p>
    {% endcall %}
    {% when None %}
    {% endmatch %}

    {# Metadata Section #}
    <div class="text-sm text-neutral-500 dark:text-neutral-400 flex gap-6">
        <span>Created: {{ activity.created_at }}</span>
        <span>Updated: {{ activity.updated_at }}</span>
    </div>
{% endcall %}
{% endblock %}
