{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center gap-4">
        <a href="/accounts" class="p-2 text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 hover:bg-neutral-100 dark:hover:bg-neutral-700 rounded-lg transition-colors" aria-label="Back to accounts">
            <span class="material-symbols-outlined w-5" aria-hidden="true">arrow_back</span>
        </a>
        <div>
            <h1 class="page-title">{{ title }}</h1>
            <p class="mt-1 text-muted">{% if account.is_some() %}Update account details{% else %}Create a new account to track{% endif %}</p>
        </div>
    </div>

    <div class="bg-white dark:bg-neutral-800 rounded-xl border border-neutral-200 dark:border-neutral-700 p-6 max-w-lg">
        <form action="{% if let Some(acc) = account %}/accounts/{{ acc.id }}/update{% else %}/accounts/create{% endif %}" method="POST" class="space-y-4">
            {% if let Some(acc) = account %}
            <div class="mb-4 p-3 bg-neutral-100 dark:bg-neutral-700 rounded-lg">
                <p class="text-sm text-neutral-600 dark:text-neutral-300">
                    <span class="font-medium">Database ID:</span> {{ acc.id }}
                </p>
                <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-1">Use this ID when importing data to associate with this account.</p>
            </div>
            {% endif %}

            <div>
                <label for="account-name" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Name</label>
                <input type="text" id="account-name" name="name" required
                    class="input w-full"
                    placeholder="e.g., Main Checking, Brokerage"
                    value="{% if let Some(acc) = account %}{{ acc.name }}{% endif %}">
            </div>

            <div>
                <label for="account-type" class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-1">Type</label>
                <select id="account-type" name="account_type" class="input w-full">
                    <option value="Cash" {% if let Some(acc) = account %}{% if acc.account_type.as_str() == "Cash" %}selected{% endif %}{% endif %}>Cash</option>
                    <option value="Securities" {% if let Some(acc) = account %}{% if acc.account_type.as_str() == "Securities" %}selected{% endif %}{% endif %}>Securities</option>
                </select>
                <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-1">
                    Cash accounts can be linked to expenses. Securities accounts can be linked to trading activities.
                </p>
            </div>

            <div class="flex gap-3 pt-4">
                <a href="/accounts" class="btn btn-secondary flex-1 text-center">
                    Cancel
                </a>
                <button type="submit" class="btn btn-primary flex-1">
                    {% if account.is_some() %}Update{% else %}Add{% endif %} Account
                </button>
            </div>
        </form>

        {% if let Some(acc) = account %}
        <div class="mt-6 pt-6 border-t border-neutral-200 dark:border-neutral-700">
            <h3 class="text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3">Danger Zone</h3>
            <button
                type="button"
                onclick="deleteAccount({{ acc.id }})"
                class="btn btn-secondary text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 border-red-200 dark:border-red-800 w-full flex items-center justify-center gap-2">
                <span class="material-symbols-outlined w-5" aria-hidden="true">delete</span>
                Delete Account
            </button>
            <p class="text-xs text-neutral-500 dark:text-neutral-400 mt-2">
                This will remove the account. Expenses and trading activities linked to this account will have their account reference cleared.
            </p>
        </div>
        {% endif %}
    </div>
</div>

{% if account.is_some() %}
<script>
async function deleteAccount(id) {
    if (!confirm('Are you sure you want to delete this account?')) return;
    try {
        const response = await fetch('/accounts/' + id, {
            method: 'DELETE',
            headers: {
                'X-XSRF-TOKEN': '{{ xsrf_token }}'
            }
        });
        if (response.ok) {
            window.location.href = '/accounts';
        } else {
            alert('Failed to delete account');
        }
    } catch (e) {
        alert('Failed to delete account: ' + e.message);
    }
}
</script>
{% endif %}
{% endblock %}
