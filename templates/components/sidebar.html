{% macro sidebar_section(label, id, title, icons, is_active) %}
<div class="mt-6 pt-6 border-t border-neutral-200 dark:border-neutral-700 px-2" data-sidebar-section>
    <button
        type="button"
        class="sidebar-section-toggle lg:hidden flex items-center justify-between w-full px-4 mb-2 text-xs font-semibold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider"
        aria-expanded="{{ is_active }}"
        aria-controls="sidebar-section-{{ id }}"
    >
        <span>{{ label }}</span>
        <span class="icon-xs sidebar-section-chevron transition-transform duration-200 {% if is_active %}rotate-180{% endif %}" aria-hidden="true">{{ icons.get("chevron-down")|safe }}</span>
    </button>
    <p class="hidden lg:block px-4 mb-2 text-xs font-semibold text-neutral-400 dark:text-neutral-500 uppercase tracking-wider">{{ label }}</p>
    <div
        id="sidebar-section-{{ id }}"
        class="sidebar-section-items space-y-0.5 lg:!block {% if !is_active %}hidden{% endif %}"
    >
        {{ caller() }}
    </div>
</div>
{% endmacro %}

<aside id="sidebar" class="fixed left-0 top-14 bottom-0 w-56 bg-white dark:bg-neutral-800 border-r border-neutral-200 dark:border-neutral-700 transform -translate-x-full lg:translate-x-0 transition-transform z-20 flex flex-col">
    <nav class="flex-1 overflow-y-auto py-4" aria-label="Main navigation">
        <div class="space-y-0.5 px-2">
            <a href="/" class="nav-item {% if title == "Dashboard" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("home")|safe }}</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
        </div>

        {% call sidebar_section("Insights", "insights", title, icons,
            title == "Balances" || title == "Spending" || title == "Recurring Expenses" || title == "Positions" || title == "Net Worth"
        ) %}
            <a href="/balances" class="nav-item {% if title == "Balances" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("wallet")|safe }}</span>
                <span class="text-sm font-medium">Balances</span>
            </a>

            <a href="/spending" class="nav-item {% if title == "Spending" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("bar-chart")|safe }}</span>
                <span class="text-sm font-medium">Spending</span>
            </a>

            <a href="/recurring-expenses" class="nav-item {% if title == "Recurring Expenses" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("repeat")|safe }}</span>
                <span class="text-sm font-medium">Recurring</span>
            </a>

            <a href="/trading/positions" class="nav-item {% if title == "Positions" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("package")|safe }}</span>
                <span class="text-sm font-medium">Positions</span>
            </a>

            <a href="/trading/net-worth" class="nav-item {% if title == "Net Worth" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("banknote")|safe }}</span>
                <span class="text-sm font-medium">Net Worth</span>
            </a>
        {% endcall %}

        {% call sidebar_section("Data", "data", title, icons,
            title == "Accounts" || title == "Add Account" || title == "Edit Account"
            || title == "Transactions"
            || title == "Trading Activities"
            || title == "Market Data"
            || title == "Import" || title == "Import Transactions" || title == "Import Trading Activities"
            || title == "Manage" || title == "Add Category" || title == "Edit Category"
            || title == "Add Tag" || title == "Add Rule" || title == "Edit Rule"
            || title == "AI Categorization"
        ) %}
            <a href="/accounts" class="nav-item {% if title == "Accounts" || title == "Add Account" || title == "Edit Account" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("credit-card")|safe }}</span>
                <span class="text-sm font-medium">Accounts</span>
            </a>

            <a href="/transactions" class="nav-item {% if title == "Transactions" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("receipt")|safe }}</span>
                <span class="text-sm font-medium">Transactions</span>
            </a>

            <a href="/trading/activities" class="nav-item {% if title == "Trading Activities" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("trending-up")|safe }}</span>
                <span class="text-sm font-medium">Activities</span>
            </a>

            <a href="/trading/market-data" class="nav-item {% if title == "Market Data" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("line-chart")|safe }}</span>
                <span class="text-sm font-medium">Market Data</span>
            </a>

            <a href="/import" class="nav-item {% if title == "Import" || title == "Import Transactions" || title == "Import Trading Activities" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("upload")|safe }}</span>
                <span class="text-sm font-medium">Bulk Import</span>
            </a>

            <a href="/manage" class="nav-item {% if title == "Manage" || title == "Add Category" || title == "Edit Category" || title == "Add Tag" || title == "Add Rule" || title == "Edit Rule" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("sliders-horizontal")|safe }}</span>
                <span class="text-sm font-medium">Manage</span>
            </a>

            <a href="/ai-categorization" class="nav-item {% if title == "AI Categorization" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("sparkles")|safe }}</span>
                <span class="text-sm font-medium">AI Categorize</span>
            </a>
        {% endcall %}

        <div class="mt-6 pt-6 border-t border-neutral-200 dark:border-neutral-700 px-2">
            <a href="/settings" class="nav-item {% if title == "Settings" %}nav-item-active{% endif %}">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("settings")|safe }}</span>
                <span class="text-sm font-medium">Settings</span>
            </a>
        </div>
    </nav>
    <footer class="px-4 py-3 border-t border-neutral-200 dark:border-neutral-700">
        <div class="flex items-center justify-between text-xs text-neutral-500 dark:text-neutral-400">
            <span>v{{ version }}</span>
            <a href="https://github.com/AdrianVollmer/Solvency" target="_blank" rel="noopener noreferrer" class="hover:text-neutral-700 dark:hover:text-neutral-300 transition-colors" aria-label="View on GitHub">
                <span class="icon-sm" aria-hidden="true">{{ icons.get("github")|safe }}</span>
            </a>
        </div>
    </footer>
</aside>
<div id="sidebar-backdrop" class="fixed inset-0 bg-black/50 z-10 hidden lg:hidden" aria-hidden="true"></div>
